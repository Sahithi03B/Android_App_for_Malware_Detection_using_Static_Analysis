package com.example.spyware4; // Replace with your app's package name
import android.content.DialogInterface;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.os.Bundle;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.ListView;
import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.app.AppCompatActivity;
import java.util.ArrayList;
import java.util.List;

public class ContinueActivity extends AppCompatActivity {

    private Button listAppsButton;
    private ListView appsListView;
    private ArrayAdapter<String> appsAdapter;
    private List<PackageInfo> installedApps;
    private PackageManager packageManager;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_continue);

        listAppsButton = findViewById(R.id.listAppsButton);
        appsListView = findViewById(R.id.appsListView);

        // Initialize the package manager and list of installed apps
        packageManager = getPackageManager();
        installedApps = packageManager.getInstalledPackages(PackageManager.GET_PERMISSIONS);

        // Create an adapter for the list of apps
        ArrayList<String> appNames = new ArrayList<>();
        for (PackageInfo packageInfo : installedApps) {
            appNames.add(packageInfo.applicationInfo.loadLabel(packageManager).toString());
        }
        appsAdapter = new ArrayAdapter<>(this, android.R.layout.simple_list_item_1, appNames);
        appsListView.setAdapter(appsAdapter);

        // Set up the click event to display permissions on app selection
        appsListView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> adapterView, View view, int position, long id) {
                PackageInfo selectedAppInfo = installedApps.get(position);
                showPermissionsDialog(selectedAppInfo);
            }
        });

        listAppsButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                // Show the list of installed apps
                appsListView.setVisibility(View.VISIBLE);
            }
        });
    }

    private void showPermissionsDialog(PackageInfo packageInfo) {
        AlertDialog.Builder builder = new AlertDialog.Builder(this);
        builder.setTitle("Permissions for " + packageInfo.applicationInfo.loadLabel(packageManager));

        String[] permissions = packageInfo.requestedPermissions;
        if (permissions != null && permissions.length > 0) {
            StringBuilder permissionsText = new StringBuilder();
            for (String permission : permissions) {
                permissionsText.append(permission).append("\n");
            }
            builder.setMessage(permissionsText.toString());
        } else {
            builder.setMessage("No permissions requested.");
        }

        // Set a positive button with a click listener
        builder.setPositiveButton("OK", new DialogInterface.OnClickListener() {
            @Override
            public void onClick(DialogInterface dialogInterface, int i) {
                // Handle OK button click if needed
                dialogInterface.dismiss(); // Close the dialog if necessary
            }
        });

        builder.create().show();
    }
}
